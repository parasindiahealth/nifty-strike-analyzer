<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nifty Strike Analyzer</title>
  <!-- Tailwind via CDN (no build step) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lightweight Charts -->
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
  <style>
    body { background: #071029; color:#e6eef8; font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border: 1px solid rgba(255,255,255,0.03); }
    .small { font-size:0.9rem; color:#bcd2ff; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; }
    a.link { color:#93c5fd; text-decoration:underline; }
  </style>
</head>
<body class="p-6">
  <div class="max-w-7xl mx-auto">
    <header class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-2xl font-semibold">Nifty Strike Analyzer</h1>
        <div class="small">LightweightCharts + Tailwind + TF.js — Advanced browser prototype</div>
      </div>
      <div class="flex gap-3 items-center">
        <select id="symbolSel" class="rounded px-3 py-2 bg-slate-900 border border-slate-700">
          <option>NIFTY</option>
          <option>BANKNIFTY</option>
        </select>
        <button id="deployWorkerBtn" class="px-3 py-2 bg-emerald-500 text-slate-900 rounded font-medium">Worker Info</button>
      </div>
    </header>

    <div class="grid grid-cols-12 gap-6">
      <div class="col-span-8 card p-4 rounded-lg">
        <div id="chart" style="height:460px;"></div>

        <div class="mt-3 flex items-center justify-between">
          <div class="small">Underlying: <span id="underVal">-</span> · Latest Signal: <span id="latestSignal">HOLD</span></div>
          <div class="flex gap-2">
            <button id="trainBtn" class="px-3 py-1 rounded bg-indigo-600">Train Model</button>
            <button id="predictBtn" class="px-3 py-1 rounded bg-amber-500">Predict Next</button>
          </div>
        </div>

        <div class="mt-4 grid grid-cols-3 gap-3">
          <div class="card p-3 rounded">
            <div class="font-semibold">Indicators</div>
            <div class="small mt-2">MA(22), Bollinger, ADX, RSI, MACD</div>
            <label class="inline-flex items-center mt-2"><input id="chkMA" type="checkbox" class="mr-2" checked>MA(22)</label><br/>
            <label class="inline-flex items-center mt-2"><input id="chkBB" type="checkbox" class="mr-2" checked>Bollinger</label><br/>
            <label class="inline-flex items-center mt-2"><input id="chkADX" type="checkbox" class="mr-2" checked>ADX</label><br/>
            <label class="inline-flex items-center mt-2"><input id="chkRSI" type="checkbox" class="mr-2">RSI</label><br/>
            <label class="inline-flex items-center mt-2"><input id="chkMACD" type="checkbox" class="mr-2">MACD</label>
          </div>

          <div class="card p-3 rounded">
            <div class="font-semibold">Data</div>
            <div class="mt-2 small">Upload OHLCV CSV (date,open,high,low,close,volume) or use option-chain historic CSVs.</div>
            <input id="fileInput" type="file" accept=".csv" class="mt-2 block w-full text-slate-200 bg-slate-800/40 rounded" />
            <input id="strikeInput" placeholder="Enter strike to highlight" class="mt-2 block w-full rounded bg-slate-800/40 p-2" />
            <button id="loadBtn" class="mt-2 px-3 py-2 bg-sky-600 rounded">Load & Analyze</button>
            <div class="mt-2 small">Or paste FII/DII CSV in README format.</div>
          </div>

          <div class="card p-3 rounded">
            <div class="font-semibold">Option Chain</div>
            <div class="mt-2 small">Live option chain via proxy worker. Select expiry below.</div>
            <div id="ocControls" class="mt-3 flex gap-2 items-center">
              <select id="ocExpiry" class="rounded bg-slate-900 p-2"></select>
              <select id="ocRefresh" class="rounded bg-slate-900 p-2"><option value="0">No refresh</option><option value="30">30s</option><option value="60" selected>60s</option></select>
              <button id="ocFetchBtn" class="px-3 py-1 rounded bg-rose-600">Fetch OC</button>
            </div>
            <div id="ocInfo" class="mt-2 small">--</div>
            <div id="ocContainer" class="mt-3 overflow-auto max-h-60"></div>
          </div>
        </div>

      </div>

      <div class="col-span-4">
        <div class="card p-4 rounded mb-4">
          <h3 class="font-semibold">Signals</h3>
          <pre id="diag" class="mt-2 small bg-slate-900 p-3 rounded max-h-44 overflow-auto mono">No data loaded.</pre>
        </div>

        <div class="card p-4 rounded mb-4">
          <h3 class="font-semibold">News & Sentiment</h3>
          <div class="small mt-2">Fetches Google News RSS and scores keywords (demo). Paste URL or use built-in RSS.</div>
          <input id="newsUrl" placeholder="Enter RSS to analyze" class="mt-2 block w-full rounded bg-slate-800/40 p-2" />
          <button id="newsFetchBtn" class="mt-2 px-3 py-1 rounded bg-violet-600">Analyze News</button>
          <div id="newsOut" class="mt-3 small"></div>
        </div>

        <div class="card p-4 rounded">
          <h3 class="font-semibold">Quick actions</h3>
          <div class="mt-3 flex flex-col gap-2">
            <button id="exportBtn" class="px-3 py-2 rounded bg-slate-700">Export Signals CSV</button>
            <button id="showReadme" class="px-3 py-2 rounded bg-slate-700">Show README</button>
          </div>
        </div>
      </div>
    </div>

    <footer class="mt-6 small">Prototype only. Do not trade live without testing & approvals.</footer>
  </div>

  <!-- App scripts -->
  <script src="assets/js/ocWidget.js"></script>
  <script src="assets/js/app.js"></script>
</body>
</html>
